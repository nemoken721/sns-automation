# SNSオートメーションシステム 要件定義書 (Ver 2.0)

## 1. プロジェクト概要

### 1.1. プロダクトビジョン
**「1日1分、ビジネスの視座を高める」**
中小企業経営者や個人事業主をターゲットに、単なるノウハウの羅列ではなく、深いリサーチ（Deep Research）に基づいた有益なビジネス情報を、Instagramリール（60秒動画）形式で自動配信する。

### 1.2. 開発目的
1.  **自社運用:** 開発者自身のブランド構築における「コンテンツ制作の工数ゼロ化」と「質の担保」の両立。
2.  **SaaS展開:** 将来的に同ターゲット層（時間のない経営者など）へ向けた月額課金型ツールとしてリリースする。

### 1.3. コア・バリュー（差別化要因）
* **Deep Research:** 生成AIの薄い回答ではなく、Google検索と複合推論を用いた「NotebookLM級」の深い情報設計。
* **High Readability:** 画像生成AIに文字を書かせず、プログラム合成することで「絶対に崩れない・読める」スライドデザイン。
* **AI-Driven PDCA:** 過去の投稿データを分析し、トレンドを加味して「勝てる企画」を自律的に立案する。

---

## 2. システムアーキテクチャ (SaaS対応構成)

将来的なスケールとコスト効率を両立する「モダンなサーバーレス構成」を採用する。

| レイヤー | 技術スタック | 選定理由・役割 |
| :--- | :--- | :--- |
| **Frontend** | **Next.js (App Router)** | 高速なUI/UX、将来のSaaS化（認証・決済連携）に必須。Vercelへデプロイ。 |
| **Backend / DB** | **Supabase** | 認証(Auth)、DB(PostgreSQL)、リアルタイム通信を一元管理。マルチテナント構造の基盤。 |
| **Storage** | **Supabase Storage** | 動画・画像アセットの保存。将来的にCloudflare R2への移行も視野。 |
| **Worker (動画生成)** | **Google Cloud Run (Jobs)** | **最重要。** Pythonコンテナ(FFmpeg/Pillow含)を実行。Vercelのタイムアウト制限(60秒)を回避し、重い動画生成処理を行う。 |
| **Brain (AI)** | **Gemini 1.5 Pro** | 企画・構成・リサーチ・コード生成・トレンド検索。 |
| **Creative (画像)** | **DALL-E 3 (OpenAI)** | プロンプト追従性が高いため、背景イラスト素材の生成に使用。 |
| **Social API** | **Meta Graph API** | Instagramへの予約投稿・インサイトデータ取得。 |

---

## 3. 機能要件詳細

### 3.1. 企画・管理フェーズ (The "Brain")

#### **① AI編集会議（月次バッチ処理）**
* **トリガー:** 月初またはユーザーの「一括生成」ボタン。
* **入力:**
    * 過去の投稿データ（Supabase上のAnalyticsテーブル）。
    * ユーザー設定（ターゲット、今月の強化テーマ）。
* **処理 (Gemini Pro):**
    * **トレンド検索:** Grounding機能で「直近のビジネストレンド」「法改正」等を検索。
    * **企画立案:** 「過去の勝ちパターン」7割 ＋ 「トレンド/新規性」3割の比率で30日分のネタを生成。
* **出力:** 30日分のタイトル、ターゲット、概要をDB(`posts`テーブル)に保存。

#### **② インタラクティブ・カレンダーUI (Next.js)**
* **表示:** 月間カレンダー形式で、各日のネタ（タイトル）とステータス（企画済/生成中/完了/予約済）を表示。
* **操作:**
    * ドラッグ＆ドロップによる日付変更。
    * 任意の日のネタをクリックして「再生成（別案提示）」または「手動編集」。

### 3.2. 制作フェーズ (The "Factory")

#### **③ Just-in-Time 生成エンジン (Cloud Run)**
* **トリガー:** 投稿予定日の**2日前**（または即時生成ボタン）。
* **Deep Research:** 確定したネタについて、再度詳細なWeb検索を実行し、最新情報を反映した台本を作成。
* **素材生成:**
    * **背景:** DALL-E 3で「文字なし・余白あり」のイラストを生成。
    * **文字:** Python (Pillow) で、背景画像の指定座標に日本語テキストを合成（装飾含む）。
    * **音声:** 外部TTS API (ElevenLabs等) で台本を音声化。
* **動画結合:** FFmpegを使用し、スライド(5-6枚)＋音声＋BGM＋ズームエフェクトを結合してmp4化。
* **通知:** 生成完了をWebフックでNext.js側に通知し、ユーザーにレビュー依頼を送る。

### 3.3. 運用・改善フェーズ (The "Manager")

#### **④ アナリティクス・フィードバック**
* **データ取得:** 定期的にMeta APIを叩き、投稿済みの動画の再生数・保存数をDBに格納。
* **学習:** 次回の「AI編集会議」の際、このデータをGeminiのプロンプト（コンテキスト）に含めることで、企画精度を向上させる。

#### **⑤ オート・パブリッシャー**
* **機能:** ユーザーが「承認」した動画を、指定時刻にInstagramへアップロード。
* **詳細:** 動画だけでなく、Geminiが生成したキャプション（ハッシュタグ含む）も自動入力。

---

## 4. データベース設計方針 (SaaS前提)

最初からマルチテナント（複数ユーザー対応）を前提としたスキーマ設計を行う。

* **`profiles` テーブル:** ユーザー情報。
* **`posts` テーブル:** 動画プロジェクトの本体。
    * `id`, `user_id` (外部キー), `title`, `script_json`, `status`, `scheduled_at`
* **`assets` テーブル:** 生成された画像や音声のパス。
    * `post_id` に紐づく。再生成時の管理用。
* **`analytics` テーブル:** 投稿後のパフォーマンス。
    * `post_id`, `views`, `likes`, `saves`

---

## 5. 品質・コスト・制約条件

### 5.1. クオリティ基準 (Quality Assurance)
* **可読性:** スマートフォン画面で視認可能なフォントサイズ（40pt以上推奨）とコントラスト比を確保する。
* **整合性:** 台本とスライドの内容に乖離がないこと。GeminiのJSON出力時に厳密なチェックを行う。

### 5.2. コスト目標 (Cost Control)
* **目標:** API原価 **月額 2,000円以内**（1ユーザー/月30本投稿時）。
* **施策:**
    * 動画生成を一括ではなく「直前生成」にすることで、ボツになった企画の生成コスト（画像生成代）を削減する。
    * Cloud Runは「常時起動」ではなく「Jobs（バッチ実行）」を利用し、課金を秒単位に抑える。

---

## 6. 開発ロードマップ

### Phase 1: MVP (Core Engine) - 2週間
* **目標:** 手元のPCでPythonスクリプトを動かし、1本の高品質な動画が自動生成されること。
* **実装:** GeminiでのJSON台本作成、Pillowでの文字入れ、FFmpegでの結合。

### Phase 2: Platform Integration - 2週間
* **目標:** ブラウザから操作できるようにする。
* **実装:** Next.js + Supabaseの構築。Cloud RunへのDockerデプロイ。カレンダーUIの実装。

### Phase 3: Automation & Analytics - 継続
* **目標:** 完全放置運用とSaaS化準備。
* **実装:** Meta API連携、トレンド検索機能の追加、マルチテナント検証。